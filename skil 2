/*CREATE DATABASE PII WITH template template0 locale "is_IS.UTF-8";*/

/*Query 1 */
SELECT 1 AS Query;
    SELECT
        L.LocationID,
        L.location
    From
        Locations L
    ORDER BY
        L.location DESC,
        L.LocationID;

/*Query 2 */
SELECT 2 AS Query;
    SELECT
        L.location,
        L.caseCount
    FROM
        Locations L
    WHERE
        L.caseCount >= 1
    ORDER BY
        L.location ASC;

/*Query 3 */
SELECT 3 AS Query;
    SELECT
        COUNT(P.GenderID)
    FROM
        People P
        INNER JOIN Genders G on P.GenderID = G.GenderID
    WHERE
        G.gender = 'Female';

/*Query 4 */
SELECT 4 AS Query;
    SELECT
        P.name
    FROM
        Agents A
        INNER JOIN People P ON A.secretIdentity = P.PersonID
        INNER JOIN Cases C ON A.AgentID = C.AgentID
    GROUP BY
        P.name
    having
        count(*) > 10;

/*Query 5 */
SELECT 5 AS Query;
    SELECT
        P.name,
        P.PersonID,
        C.Title
    From
        People P
        INNER JOIN InvolvedIn I on P.PersonID = I.PersonID
        /* Hverjir voru involved*/
        INNER JOIN Cases C on P.LocationID = C.LocationID
        AND C.CaseID = I.CaseID
        /*Hverjir búa þar sem caesið gerist*/
    WHERE
        I.isCulprit = TRUE;

/*Query 6 */
SELECT 6 AS Query;
    SELECT
        DISTINCT P.PersonID,
        P.name,
        G.gender
    FROM
        InvolvedIn I
        INNER JOIN People P on P.PersonID = I.PersonID
        INNER JOIN Genders G on G.genderID = P.GenderID
        INNER JOIN Cases C on C.CaseID = I.CaseID
        INNER JOIN Locations L on L.LocationID = C.LocationID
    Where
        L.location = 'Selfoss';

/*Query 7 */
SELECT 7 AS Query;
    SELECT
        P.PersonID,
        P.name,
        Pf.description,
        Count(P.name) AS numcases
    From
        People P
        INNER JOIN Professions Pf ON P.ProfessionID = Pf.ProfessionID
        INNER JOIN InvolvedIn I ON P.PersonID = I.PersonID
        INNER JOIN Cases C ON I.CaseID = C.CaseID
    Where
        C.isClosed = False
        AND Pf.description LIKE '% therapist'
    GROUP BY
        P.name,
        Pf.description,
        P.PersonID;

/*Query 8 */
SELECT 8 AS Query;
    SELECT
        A.Codename,
        G.gender,
        P.password
    From
        Agents A
        INNER JOIN Genders G on A.GenderID = G.GenderID
        INNER JOIN Passwords P on A.AgentID = P.AgentID
    Where
        P.password LIKE concat('%', A.Codename, '%');

/*Query 9 */
SELECT 9 AS Query;
    SELECT
        I.PersonID,
        P.name,
        CASE
            WHEN I.isCulprit = TRUE THEN 'guilty'
            else 'not guilty'
        end as hasbeenculprit
    FROM
        InvolvedIn I
        INNER JOIN Cases C on C.CaseID = I.CaseID
        INNER JOIN People P on I.PersonID = P.PersonID
        INNER JOIN Locations L on C.LocationID = L.LocationID
    Where
        L.location LIKE '%vogur'
    GROUP BY
        P.name,
        I.PersonID,
        I.isCulprit
    having
        count(*) > 1;

/*Query 10 */
SELECT 10 AS Query;
    SELECT
        P.PersonID,
        P.name,
        G.gender,
        2045 - MAX(C.year) as yearsSinceLastInvestigation
    FROM
        Agents A
        INNER JOIN InvolvedIn I on A.AgentID = I.AgentID
        INNER JOIN People P on P.PersonID = I.PersonID
        INNER JOIN Genders G on G.GenderID = P.GenderID
        INNER JOIN Cases C on C.CaseID = I.CaseID
    GROUP BY
        P.PersonID,
        P.name,
        G.gender
    HAVING
        count(*) = 3
        and count(distinct A.AgentID) = 3;

